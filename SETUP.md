# Инструкция по настройке FitnessBotAI

## 1. Создание Telegram бота

1. Найдите в Telegram бота @BotFather
2. Отправьте команду `/newbot`
3. Введите имя бота (например: "FitnessBotAI")
4. Введите username бота (например: "fitness_bot_ai_bot")
5. Сохраните полученный токен

## 2. Настройка Coze API

1. Зайдите на [coze.com](https://www.coze.com)
2. Войдите в свой аккаунт
3. Перейдите в раздел API
4. Создайте новый API ключ
5. Найдите ID вашего бота в разделе "My Bots"

## 3. Настройка ЮКассы

1. Зарегистрируйтесь в [ЮКассе](https://yookassa.ru)
2. Пройдите модерацию магазина
3. В личном кабинете найдите:
   - Shop ID (идентификатор магазина)
   - Secret Key (секретный ключ)

## 4. Настройка проекта

1. Скопируйте `.env.example` в `.env`:
   ```bash
   cp .env.example .env
   ```

2. Заполните все переменные в файле `.env`:
   ```
   TELEGRAM_BOT_TOKEN=ваш_токен_бота
   COZE_API_KEY=ваш_api_ключ_coze
   COZE_BOT_ID=id_вашего_бота_в_coze
   YOOKASSA_SHOP_ID=ваш_shop_id
   YOOKASSA_SECRET_KEY=ваш_secret_key
   ```

## 5. Установка и запуск

1. Установите зависимости:
   ```bash
   npm install
   ```

2. Запустите бота:
   ```bash
   npm start
   ```

   Для разработки (с автоперезагрузкой):
   ```bash
   npm run dev
   ```

## 6. Настройка webhook для ЮКассы

1. В личном кабинете ЮКассы перейдите в "Настройки" → "Webhook"
2. Укажите URL: `https://ваш-домен.com/webhook/payment`
3. Выберите события: "payment.succeeded", "payment.canceled"

## 7. Деплой на сервер

### Для деплоя на VPS:

1. Загрузите код на сервер
2. Установите PM2 для управления процессом:
   ```bash
   npm install -g pm2
   ```

3. Запустите приложение:
   ```bash
   pm2 start src/index.js --name "fitness-bot"
   ```

### Для деплоя на Heroku:

1. Создайте приложение в Heroku
2. Добавьте переменные окружения в настройках
3. Подключите GitHub репозиторий
4. Запустите деплой

## 8. Проверка работы

1. Найдите вашего бота в Telegram
2. Отправьте команду `/start`
3. Проверьте все функции:
   - Регистрация пользователя
   - Просмотр планов подписки
   - Создание платежа
   - Активация подписки после оплаты
   - Общение с ИИ

## Возможные проблемы

### Ошибка подключения к Coze API
- Проверьте правильность API ключа
- Убедитесь, что бот опубликован в Coze

### Ошибки с платежами
- Проверьте настройки webhook в ЮКассе
- Убедитесь в правильности Shop ID и Secret Key

### Ошибки базы данных
- Проверьте права на запись в папку `data/`
- Убедитесь, что SQLite установлен

## Полезные команды

```bash
# Просмотр логов PM2
pm2 logs fitness-bot

# Перезапуск приложения
pm2 restart fitness-bot

# Остановка приложения
pm2 stop fitness-bot

# Просмотр статуса
pm2 status
```
