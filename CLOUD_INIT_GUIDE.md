# üöÄ Cloud-init –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è TimeWeb

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π FitnessBotAI —Å –ø–æ–º–æ—â—å—é Cloud-init

### üìã –ß—Ç–æ –¥–µ–ª–∞—é—Ç —Å–∫—Ä–∏–ø—Ç—ã:

**cloud-init-timeweb.yaml** - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–¥–∞–∫—à–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js LTS + PM2
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx —Å rate limiting
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è firewall (UFW)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è botuser
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

**cloud-init-simple.yaml** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### üõ† –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

#### 1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ –≤ TimeWeb:
1. –í—ã–±–µ—Ä–∏—Ç–µ Ubuntu 24.04
2. –í —Ä–∞–∑–¥–µ–ª–µ "Cloud-init" –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `cloud-init-timeweb.yaml`
3. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à SSH –∫–ª—é—á
4. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä

#### 2. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@YOUR_SERVER_IP

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é botuser
su - botuser
cd GymMindAI

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.template .env
nano .env  # –ó–∞–ø–æ–ª–Ω—è–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
./deploy-production.sh
```

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞:

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```env
TELEGRAM_BOT_TOKEN=6925387250:AAH8Z...  # –¢–æ–∫–µ–Ω –æ—Ç @BotFather
COZE_API_KEY=pat_xxx...                 # API –∫–ª—é—á Coze
COZE_BOT_ID=7444280...                  # ID –±–æ—Ç–∞ –≤ Coze
YOOKASSA_PROD_SECRET_KEY=live_xxx...    # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á YooKassa
WEBHOOK_URL=https://YOUR_DOMAIN.com/webhook
ADMIN_IDS=YOUR_TELEGRAM_ID
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
# –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
pm2 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs fitnessbotai

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart fitnessbotai

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
./monitor.sh

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull && pm2 restart fitnessbotai
```

### üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot --nginx -d yourdomain.com

# –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo crontab -e
# –î–æ–±–∞–≤–∏—Ç—å: 0 12 * * * /usr/bin/certbot renew --quiet
```

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```
/home/botuser/GymMindAI/           # –ü—Ä–æ–µ–∫—Ç
‚îú‚îÄ‚îÄ src/                           # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îú‚îÄ‚îÄ data/subscriptions.db          # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ .env                          # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ ecosystem.production.config.js # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PM2
‚îú‚îÄ‚îÄ deploy-production.sh          # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
‚îî‚îÄ‚îÄ monitor.sh                    # –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

/var/log/fitnessbotai/            # –õ–æ–≥–∏
‚îú‚îÄ‚îÄ combined.log                  # –í—Å–µ –ª–æ–≥–∏
‚îú‚îÄ‚îÄ out.log                      # Stdout
‚îî‚îÄ‚îÄ error.log                    # –û—à–∏–±–∫–∏

/etc/nginx/sites-available/       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îî‚îÄ‚îÄ fitnessbotai                 # –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è –±–æ—Ç–∞
```

### üö® Troubleshooting:

**–ï—Å–ª–∏ cloud-init –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cloud-init
sudo cat /var/log/cloud-init-output.log

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã –≤—Ä—É—á–Ω—É—é
sudo apt update && sudo apt install -y nodejs npm git nginx
```

**–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cat /home/botuser/GymMindAI/.env

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo -u botuser pm2 logs fitnessbotai

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
cd /home/botuser/GymMindAI
sudo -u botuser node src/index.js
```

**–ï—Å–ª–∏ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Nginx
sudo nginx -t
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã
sudo netstat -tlnp | grep :3004
sudo netstat -tlnp | grep :80
```

### üéØ –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞:

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ cloud-init-timeweb.yaml** –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å TimeWeb
2. **–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä** —Å Ubuntu 24.04
3. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
su - botuser
cd GymMindAI
cp .env.template .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–∞—à–∏ —Ç–æ–∫–µ–Ω—ã
./deploy-production.sh
```

**–ì–æ—Ç–æ–≤–æ! –í–∞—à –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! üéâ**
