# üîß –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook YooKassa –≤—Ä—É—á–Ω—É—é

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º YooKassa

YooKassa **–Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤–µ–±—Ö—É–∫–∏ —á–µ—Ä–µ–∑ API –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.
–í–µ–±—Ö—É–∫–∏ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **–≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç**.

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç YooKassa

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://yookassa.ru/
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
3. –í—ã–±–µ—Ä–∏—Ç–µ **–¢–µ—Å—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω** (Shop ID: 1139867)

---

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"** –∏–ª–∏ **"HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"**

---

### –®–∞–≥ 3: –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –≤–µ–±—Ö—É–∫

1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"** –∏–ª–∏ **"+"**

2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

   **URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   ```
   https://85.192.32.248:3004/webhook/payment
   ```

   **–°–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - ‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ: **payment.succeeded** (–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂)
   - ‚ùå –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –º–æ–∂–Ω–æ –Ω–µ –æ—Ç–º–µ—á–∞—Ç—å

3. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"** –∏–ª–∏ **"–î–æ–±–∞–≤–∏—Ç—å"**

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```
URL: https://85.192.32.248:3004/webhook/payment
–°–æ–±—ã—Ç–∏–µ: payment.succeeded
–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–æ
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ curl:

```bash
curl https://85.192.32.248:3004/webhook/payment
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "message": "Payment webhook endpoint is ready",
  "method": "Use POST to send payment notifications",
  "timestamp": "2025-10-08T13:00:00.000Z",
  "server_ip": "..."
}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `npm start`

2. –í Telegram –±–æ—Ç–µ:
   - –ù–∞–∂–º–∏—Ç–µ: **üíé –ü–æ–¥–ø–∏—Å–∫–∞** ‚Üí **üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É**
   - –í—ã–±–µ—Ä–∏—Ç–µ: **üöÄ –ü—Ä–µ–º–∏—É–º –ø–ª–∞–Ω - 450‚ÇΩ**
   - –ù–∞–∂–º–∏—Ç–µ: **üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å**

3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –æ–ø–ª–∞—Ç—ã

4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É**:
   ```
   –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: 5555 5555 5555 4444
   –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 12/25 (–ª—é–±–æ–π –±—É–¥—É—â–∏–π)
   CVC: 123 (–ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã)
   –î–µ—Ä–∂–∞—Ç–µ–ª—å: TEST CARD
   ```

5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–ø–ª–∞—Ç—É

6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
   ```
   üîî Payment webhook received at: 2025-10-08T...
   üì® Headers: {...}
   üì¶ Body: {"event":"payment.succeeded",...}
   ‚úÖ Payment successful for user 659874549, plan: premium
   üí∞ Payment successfully processed...
   ```

7. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram** - –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```
   ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!
   
   üìã –î–µ—Ç–∞–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏:
   –ü–ª–∞–Ω: –ü—Ä–µ–º–∏—É–º
   –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–µ—Å—è—Ü: 600
   –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: 07.11.2025
   ```

---

## ‚ùó –ï—Å–ª–∏ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –° –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
curl https://85.192.32.248:3004/webhook/payment

# –° –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)
# https://reqbin.com/ –∏–ª–∏ https://httpbin.org/
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 3004 –æ—Ç–∫—Ä—ã—Ç –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ—Ä—Ç 3004
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –≤–∞–ª–∏–¥–µ–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
curl -v https://85.192.32.248:3004/webhook/payment
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ SSL:**
```
SSL certificate problem: self signed certificate
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
  ```bash
  ngrok http 3004
  # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö webhook
  ```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: YooKassa –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa:**
1. –†–∞–∑–¥–µ–ª "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" ‚Üí "–ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏"
2. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –æ–± –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
3. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - —Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–µ

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- ‚úÖ **200 OK** - –≤–µ–±—Ö—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **Connection timeout** - —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- ‚ùå **SSL error** - –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- ‚ùå **404 Not Found** - –Ω–µ–≤–µ—Ä–Ω—ã–π URL

---

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: ngrok (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Å SSL, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok:

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok:
```bash
# Windows
choco install ngrok

# –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å https://ngrok.com/download
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok:
```bash
ngrok http 3004
```

**–í—ã–≤–æ–¥:**
```
Forwarding https://abc123.ngrok.io -> http://localhost:3004
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok URL –≤ webhook:
```
https://abc123.ngrok.io/webhook/payment
```

### 4. –î–æ–±–∞–≤—å—Ç–µ –≤ .env:
```env
YOOKASSA_WEBHOOK_URL=https://abc123.ngrok.io/webhook/payment
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –ª–æ–≥–∏

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (npm start):

**–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ webhook:**
```
üîî Payment webhook received at: 2025-10-08T13:15:30.123Z
üì® Headers: {
  'content-type': 'application/json',
  'x-yookassa-event': 'payment.succeeded',
  ...
}
üì¶ Body: {
  "event": "payment.succeeded",
  "object": {
    "id": "307874b6-000f-5000-b000-1bd329b31340",
    "status": "succeeded",
    "paid": true,
    "metadata": {
      "telegram_id": "659874549",
      "plan_type": "premium",
      "requests_limit": "600"
    },
    ...
  }
}
‚úÖ Payment successful for user 659874549, plan: premium
‚úÖ Webhook processing result: {
  "success": true,
  "telegramId": "659874549",
  "planType": "premium",
  ...
}
üí∞ Payment successfully processed for user 659874549, plan: premium
```

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ü–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`npm start`)
- [ ] –ü–æ—Ä—Ç 3004 –æ—Ç–∫—Ä—ã—Ç –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ
- [ ] Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: `curl https://85.192.32.248:3004/webhook/payment`
- [ ] Webhook –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa
- [ ] –í .env —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `YOOKASSA_WEBHOOK_URL`
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω (`PAYMENT_MODE=test`)
- [ ] Shop ID: 1139867 (—Ç–µ—Å—Ç–æ–≤—ã–π)

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç** ‚Üí 
2. **YooKassa –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook** ‚Üí 
3. **–í–∞—à —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** ‚Üí 
4. **–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É** ‚Üí 
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∞–∫—Ç–∏–≤–∞—Ü–∏–∏** ‚úÖ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ YooKassa** - –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ —Ä–∞–∑–¥–µ–ª "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" ‚Üí "–ò—Å—Ç–æ—Ä–∏—è"
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - `npm start` –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤—ã–≤–æ–¥
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** - –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `subscriptions`
4. **–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π YooKassa** - –æ–Ω–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π webhooks

---

**–î–∞—Ç–∞:** 08.10.2025  
**–†–µ–∂–∏–º:** –¢–µ—Å—Ç–æ–≤—ã–π  
**Shop ID:** 1139867
